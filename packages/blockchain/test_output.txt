
> landchain-chaincode@0.0.1 test
> ts-mocha tests/**/*.test.ts tests/ComprehensiveMetadata.test.ts

2026-02-16T17:40:40.740Z [32minfo[39m [c-api:./lib/annotations/object.js]                 @Object args: Target -> %s "Function" 
2026-02-16T17:40:40.741Z [32minfo[39m [c-api:./lib/annotations/object.js]                 @Object args: Target -> %s "Function" 
2026-02-16T17:40:40.742Z [32minfo[39m [c-api:./lib/annotations/object.js]                 @Object args: Target -> %s "Function" 
2026-02-16T17:40:40.742Z [32minfo[39m [c-api:./lib/annotations/object.js]                 @Object args: Target -> %s "Function" 
2026-02-16T17:40:40.746Z [32minfo[39m [c-api:./lib/annotations/object.js]                 @Object args: Target -> %s "Function" 
2026-02-16T17:40:40.750Z [32minfo[39m [c-api:./lib/annotations/object.js]                 @Object args: Target -> %s "Function" 
2026-02-16T17:40:40.755Z [32minfo[39m [c-api:./lib/annotations/object.js]                 @Object args: Target -> %s "Function" 
2026-02-16T17:40:40.771Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Transaction args: "Property Key -> initLedger, Commit -> true,","Target ->","LandChainContract" 
2026-02-16T17:40:40.771Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Returns args: ", Property Key -> createParcel, Return Type -> LandParcel,","Target ->","LandChainContract" 
2026-02-16T17:40:40.771Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Transaction args: "Property Key -> createParcel, Commit -> true,","Target ->","LandChainContract" 
2026-02-16T17:40:40.771Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Returns args: ", Property Key -> getParcel, Return Type -> LandParcel,","Target ->","LandChainContract" 
2026-02-16T17:40:40.771Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Transaction args: "Property Key -> getParcel, Commit -> true,","Target ->","LandChainContract" 
2026-02-16T17:40:40.771Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Returns args: ", Property Key -> getPublicParcelDetails, Return Type -> string,","Target ->","LandChainContract" 
2026-02-16T17:40:40.771Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Transaction args: "Property Key -> getPublicParcelDetails, Commit -> false,","Target ->","LandChainContract" 
2026-02-16T17:40:40.771Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Transaction args: "Property Key -> recordIntimation, Commit -> true,","Target ->","LandChainContract" 
2026-02-16T17:40:40.772Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Transaction args: "Property Key -> transferParcel, Commit -> true,","Target ->","LandChainContract" 
2026-02-16T17:40:40.772Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Transaction args: "Property Key -> getPaymentDetails, Commit -> false,","Target ->","LandChainContract" 
2026-02-16T17:40:40.772Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Transaction args: "Property Key -> resolveDispute, Commit -> true,","Target ->","LandChainContract" 
2026-02-16T17:40:40.772Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Transaction args: "Property Key -> createStrataUnit, Commit -> true,","Target ->","LandChainContract" 
2026-02-16T17:40:40.772Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Returns args: ", Property Key -> getStrataUnit, Return Type -> StrataUnit,","Target ->","LandChainContract" 
2026-02-16T17:40:40.772Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Transaction args: "Property Key -> getStrataUnit, Commit -> true,","Target ->","LandChainContract" 
2026-02-16T17:40:40.772Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Transaction args: "Property Key -> subdivideParcel, Commit -> true,","Target ->","LandChainContract" 
2026-02-16T17:40:40.773Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Transaction args: "Property Key -> convertLandUse, Commit -> true,","Target ->","LandChainContract" 
2026-02-16T17:40:40.773Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Transaction args: "Property Key -> finalizeTitle, Commit -> true,","Target ->","LandChainContract" 
2026-02-16T17:40:40.773Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Transaction args: "Property Key -> parcelExists, Commit -> false,","Target ->","LandChainContract" 
2026-02-16T17:40:40.773Z [32minfo[39m [c-api:./lib/annotations/transaction.js]            @Transaction args: "Property Key -> executeTransaction, Commit -> true,","Target ->","LandChainContract" 
2026-02-16T17:40:40.773Z [32minfo[39m [c-api:./lib/annotations/info.js]                   @Info args: "Info -> [object Object],","Target ->","LandChainContract" 


  Phase 22 Logic: Timers & Admin Validation
    AdminValidator
      âœ” should block Tribal Land transfer without DC Approval
      âœ” should block transfer if category is TRIBAL_SCHEDULED even if flag is false
      âœ” should allow Tribal Land transfer with DC Approval Hash
      âœ” should strictly block Wakf Land transfer
    Mutation Timer (approveMutation)
      âœ” should block early approval (< 30 days)
      âœ” should approve after 30 days

  Phase 34: Comprehensive Transaction Metadata
    transferParcel with Metadata
      1) should store Stamp Duty and Witness details in TitleRecord
      âœ” should validate Stamp Duty Amount

  Dynamic State Machine (Schema 2.0)
    âœ” should execute SALE transaction correctly
    âœ” should execute INHERITANCE transaction correctly
    âœ” should execute PARTITION transaction correctly
    âœ” should execute CONVERSION transaction correctly
    âœ” should block transaction if asset is LOCKED
    âœ” should block unknown transaction type

  FormatValidator (Phase 29)
    ULPIN
      âœ” should validate 14 digit numeric string
      âœ” should fail if length is not 14
      âœ” should fail if contains letters
    CNR
      âœ” should validate 16 alphanumeric chars
      âœ” should fail if length incorrect
    RERA
      âœ” should validate P + 10-12 chars
      âœ” should fail if no P prefix
    IPFS
      âœ” should validate Qm hash
      âœ” should fail if invalid start char
    Unit Conversion
      âœ” should convert Hectare to Guntha correctly
      âœ” should convert Hectare to Cent correctly

  Indian Lifecycle Workflows
    âœ” should register Agreement to Sale (ATS) and lock state
    âœ” should lock property for Succession upon Death Intimation
    âœ” should retire Parent Asset after Partition
    âœ” should process Gift as a Transfer triggering Mutation

  Judicial & Financial Locks
    âœ” should lock parcel upon Mortgage creation
    âœ” should unlock parcel when Mortgage is released
    âœ” should REMAIN locked if another Lock exists (e.g. Litigation)

  LandChainContract
    createParcel
      âœ” should create a parcel successfully
      âœ” should throw error if parcel already exists
    recordIntimation
      âœ” should record a MORTGAGE charge and lock the parcel
      âœ” should record a DISPUTE and set status to LITIGATION
    transferParcel
      âœ” should transfer parcel if no bad records exist
      âœ” should fail transfer if active Mortgage exists
    finalizeTitle
      âœ” should finalize title if no disputes
      âœ” should fail to finalize if disputes exist

  Real World Nuances (Multi-Sig Explicit)
    âœ” should block 100% sale if multiple owners exist (true Multi-Sig constraint)

  Real World Nuances (Partial Transfers & Disputes)
    Partial Transfers & Multi-Sig
      âœ” should allow partial transfer of 50% share
      âœ” should block 100% sale if multiple owners exist (Multi-Sig constraint)
      âœ” should allow A to sell their own 50% share
    Dispute Resolution
      âœ” should resolve a dispute and UNLOCK the parcel
      âœ” should resolve dispute but keep LOCKED if Mortgage exists

  Real World Scenarios (RERA, Forest, Strata)
    RERA Compliance (Strata Units)
      âœ” should Block Sale of Strata Unit without Occupancy Certificate (OC)
      âœ” should Allow Sale of Strata Unit WITH Occupancy Certificate
    Forest & Tribal Protection (Conversion)
      âœ” should Block Conversion of Forest Land
    Strata vs Parent Land Disputes
      âœ” should Block Strata Sale if Parent Land is under Litigation

  Phase 33: NITI Aayog Refinements
    Inheritance Share Validation
      âœ” should FAIL if heirs shares do not sum to 100%
      âœ” should PASS if heirs shares sum to 100%
    Public Title Search
      âœ” should return REDACTED view

  Strata Extensions (Checklist)
    âœ” should BLOCK sale of Unit if Parent Land is LOCKED (Mortgage)
    âœ” should BLOCK sale of Unit if Parent Land is RETIRED
    âœ” should ALLOW sale if Parent is FREE

  LandChainContract: Strata Titling
    createStrataUnit
      âœ” should create a Strata Unit if parent is FREE
      âœ” should fail if parent is LOCKED
    executeTransaction on StrataUnit
      âœ” should execute SALE on a StrataUnit
      âœ” should block SALE if StrataUnit is LOCKED

  Urban & Commercial Workflows (Amalgamation)
    âœ” should successfully amalgamate two parcels
    âœ” should fail amalgamation if owners mismatch
    âœ” should fail if a constituent parcel is LOCKED
    âœ” should rectify boundary (Akarband correction)


  63 passing (97ms)
  1 failing

  1) Phase 34: Comprehensive Transaction Metadata
       transferParcel with Metadata
         should store Stamp Duty and Witness details in TitleRecord:
     TypeError: Cannot read properties of undefined (reading 'lastTransaction')
      at Context.<anonymous> (tests/ComprehensiveMetadata.test.ts:56:40)



npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path /Users/chirag.thakur/Code/LandChain/LandChain/packages/blockchain
npm error workspace landchain-chaincode@0.0.1
npm error location /Users/chirag.thakur/Code/LandChain/LandChain/packages/blockchain
npm error command failed
npm error command sh -c ts-mocha tests/**/*.test.ts tests/ComprehensiveMetadata.test.ts
